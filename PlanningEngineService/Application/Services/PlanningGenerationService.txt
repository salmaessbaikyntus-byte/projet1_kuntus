public class PlanningGenerationService
{
    public List<PlanningAssignment> GeneratePlanning(
        List<Employee> employees,
        PlanningConstraint constraint,
        DateTime date)
    {
        int total = employees.Count;
        int maxUnavailable =
            total * (100 - constraint.MinAvailabilityPercentage) / 100;

        var slots = GenerateTimeSlots();
        var slotLoad = slots.ToDictionary(s => s, s => 0);

        var result = new List<PlanningAssignment>();
        var specialCaseCount = new Dictionary<Guid, int>();

        foreach (var emp in employees)
        {
            var slot = slots.First(s => slotLoad[s] < maxUnavailable);
            slotLoad[slot]++;

            var specialType = AssignSpecialCase(emp.Id, specialCaseCount);

            result.Add(new PlanningAssignment
            {
                EmployeeId = emp.Id,
                Date = date,
                LunchStart = slot,
                LunchEnd = slot.Add(TimeSpan.FromHours(1)),
                SpecialCaseType = specialType
            });
        }

        return result;
    }

    private List<TimeSpan> GenerateTimeSlots()
    {
        var list = new List<TimeSpan>();
        var start = TimeSpan.FromHours(11);

        for (int i = 0; i < 20; i++)
            list.Add(start.Add(TimeSpan.FromMinutes(15 * i)));

        return list;
    }

    private string AssignSpecialCase(
        Guid employeeId,
        Dictionary<Guid, int> counter)
    {
        if (!counter.ContainsKey(employeeId))
            counter[employeeId] = 0;

        if (counter[employeeId] < 2)
        {
            counter[employeeId]++;
            return "Standard"; // Ã©volutif
        }

        return "Standard";
    }
}
